<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Neon Auth</title>

<style>
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body {
  margin: 0;
  height: 100vh;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
}
.container {
  width: 420px;
  padding: 30px;
  background: rgba(0,0,0,0.65);
  border-radius: 18px;
  box-shadow: 0 0 25px #ae00ff88;
}
.toggle {
  display: flex;
  justify-content: space-between;
  margin-bottom: 25px;
}
.toggle button {
  width: 48%;
  padding: 10px;
  background: transparent;
  border: 2px solid #ae00ff;
  color: #ae00ff;
  border-radius: 8px;
  cursor: pointer;
}
.toggle button.active {
  background: #ae00ff;
  color: #000;
}
form { display: none; }
form.active { display: block; }

h2 {
  color: #ae00ff;
  text-align: center;
  margin-bottom: 15px;
}

input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  background: #111;
  color: #ae00ff;
}

button.submit {
  width: 100%;
  margin-top: 12px;
  padding: 12px;
  background: #ae00ff;
  color: #000;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
}

.link-btn {
  margin-top: 8px;
  background: none;
  border: none;
  color: #ae00ff;
  cursor: pointer;
}

.timer {
  color: #aaa;
  text-align: center;
  margin-top: 5px;
}
</style>
</head>

<body>

<div class="container">

  <div class="toggle">
    <button id="loginBtn" class="active">Login</button>
    <button id="registerBtn">Register</button>
  </div>

  <!-- LOGIN -->
  <form id="loginForm" class="active">
    <h2>Login</h2>
    <input id="loginMobile" placeholder="Mobile Number">
    <input id="loginPassword" type="password" placeholder="Password">
    <button class="submit">Login</button>
    <button type="button" class="link-btn" onclick="showForgot()">Forgot Password?</button>
  </form>

  <!-- REGISTER -->
  <form id="registerForm">
    <h2>Register</h2>
    <input id="regName" placeholder="Full Name">
    <input id="regMobile" placeholder="Mobile Number">
    <input id="regEmail" type="email" placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">
    <input id="regRePassword" type="password" placeholder="Re-enter Password">

    <button type="button" class="submit" onclick="sendRegisterOTP()">Send Email OTP</button>

    <input id="regOtp" placeholder="Enter OTP" style="display:none">

    <div id="regTimer" class="timer" style="display:none">
      Resend OTP in <span id="regCount">60</span>s
    </div>

    <button id="regResendBtn" class="link-btn" style="display:none" onclick="resendRegisterOTP()">Resend OTP</button>

    <button id="verifyBtn" class="submit" style="display:none" onclick="verifyRegisterOTP()">Verify & Register</button>
  </form>

  <!-- FORGOT -->
  <form id="forgotForm">
    <h2>Reset Password</h2>
    <input id="fpMobile" placeholder="Mobile Number">
    <input id="fpEmail" type="email" placeholder="Registered Email">

    <button type="button" class="submit" onclick="sendForgotOTP()">Send OTP</button>

    <input id="fpOtp" placeholder="Enter OTP" style="display:none">
    <input id="fpNewPass" type="password" placeholder="New Password" style="display:none">

    <div id="fpTimer" class="timer" style="display:none">
      Resend OTP in <span id="fpCount">60</span>s
    </div>

    <button id="fpResendBtn" class="link-btn" style="display:none" onclick="resendForgotOTP()">Resend OTP</button>

    <button id="fpVerifyBtn" class="submit" style="display:none" onclick="resetPassword()">Reset Password</button>
  </form>

</div>

<script>
const API = "https://battlepurse-78.onrender.com/api/wallet";

/* =====================
   TOGGLE FORMS
===================== */
loginBtn.onclick = () => showForm("login");
registerBtn.onclick = () => showForm("register");

function showForm(type){
  [loginForm, registerForm, forgotForm].forEach(f=>f.classList.remove("active"));
  loginBtn.classList.remove("active");
  registerBtn.classList.remove("active");

  if(type==="login"){
    loginForm.classList.add("active");
    loginBtn.classList.add("active");
  }
  if(type==="register"){
    registerForm.classList.add("active");
    registerBtn.classList.add("active");
  }
}

function showForgot(){
  loginForm.classList.remove("active");
  forgotForm.classList.add("active");
}

/* =====================
   TIMER
===================== */
function startTimer(countEl, timerBox, resendBtn){
  let t = 60;
  resendBtn.style.display = "none";
  timerBox.style.display = "block";
  countEl.innerText = t;

  const timer = setInterval(()=>{
    t--;
    countEl.innerText = t;
    if(t <= 0){
      clearInterval(timer);
      timerBox.style.display = "none";
      resendBtn.style.display = "block";
    }
  },1000);
}

/* =====================
   REGISTER
===================== */
async function sendRegisterOTP(){
  if(regPassword.value !== regRePassword.value)
    return alert("Passwords do not match");

  const body = {
    name: regName.value.trim(),
    phone: regMobile.value.trim(),
    email: regEmail.value.trim(),
    password: regPassword.value.trim()
  };

  const res = await fetch(`${API}/register-email`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });

  const d = await res.json();
  if(!res.ok) return alert(d.msg);

  regOtp.style.display = "block";
  verifyBtn.style.display = "block";
  startTimer(regCount, regTimer, regResendBtn);
  alert("OTP sent to email");
}

async function verifyRegisterOTP(){
  const res = await fetch(`${API}/verify-email-otp`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      email: regEmail.value.trim(),
      otp: regOtp.value.trim()
    })
  });

  const d = await res.json();
  if(!res.ok) return alert(d.msg);

  alert("Registration successful");
  showForm("login");
}

async function resendRegisterOTP(){
  if(!regEmail.value.trim()) return alert("Enter email first");

  await fetch(`${API}/resend-otp`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      email: regEmail.value.trim(),
      purpose: "register"
    })
  });

  startTimer(regCount, regTimer, regResendBtn);
}

/* =====================
   LOGIN
===================== */
loginForm.onsubmit = async (e) => {
  e.preventDefault();

  const phone = loginMobile.value.trim();
  const password = loginPassword.value.trim();

  if (!phone || !password) {
    alert("Phone and password required");
    return;
  }

  console.log("LOGIN DATA:", phone, password);

  const res = await fetch(`${API}/login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ phone, password })
  });

  const d = await res.json();
  console.log("LOGIN RESPONSE:", d);

  if (!res.ok) return alert(d.msg || "Login failed");

  localStorage.setItem("token", d.token);
  location.href = "gamezone.html";
};


/* =====================
   FORGOT PASSWORD
===================== */
async function sendForgotOTP(){
  const res = await fetch(`${API}/forgot/send-otp`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      phone: fpMobile.value.trim(),
      email: fpEmail.value.trim()
    })
  });

  const d = await res.json();
  if(!res.ok) return alert(d.msg);

  fpOtp.style.display = "block";
  fpNewPass.style.display = "block";
  fpVerifyBtn.style.display = "block";
  startTimer(fpCount, fpTimer, fpResendBtn);
}

async function resendForgotOTP(){
  if(!fpEmail.value.trim()) return alert("Enter email first");

  await fetch(`${API}/resend-otp`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      email: fpEmail.value.trim(),
      purpose: "forgot"
    })
  });

  startTimer(fpCount, fpTimer, fpResendBtn);
}

async function resetPassword(){
  const res = await fetch(`${API}/forgot/reset`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      phone: fpMobile.value.trim(),
      email: fpEmail.value.trim(),
      otp: fpOtp.value.trim(),
      newPassword: fpNewPass.value.trim()
    })
  });

  const d = await res.json();
  if(!res.ok) return alert(d.msg);

  alert("Password updated");
  showForm("login");
}
</script>


</body>
</html>
