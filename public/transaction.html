<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Transactions</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background: #111;
    font-family: "Poppins", sans-serif;
    color: #fff;
  }

  .header {
    padding: 15px;
    font-size: 20px;
    font-weight: 600;
    background: #1a1a1a;
    text-align: center;
    border-bottom: 1px solid #222;
  }

  .balance-box {
    margin: 15px;
    padding: 15px;
    background: #1c1c1c;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 8px #00000055;
  }

  .balance-value {
    font-size: 28px;
    font-weight: 700;
    margin-top: 8px;
  }

  .transactions-container {
    padding: 15px;
  }

  .transaction {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #1b1b1b;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 0 6px #00000040;
  }

  .info .title {
    font-size: 15px;
    font-weight: 600;
  }

  .info .date {
    font-size: 12px;
    opacity: 0.7;
  }

  .amount {
    font-size: 16px;
    font-weight: 700;
  }

  .no-records {
    text-align: center;
    margin-top: 40px;
    opacity: 0.7;
    font-size: 15px;
  }
</style>
</head>

<body>

<div class="header">Transaction History</div>

<div class="balance-box">
  <div>Wallet Balance</div>
  <div class="balance-value" id="balance">₹0</div>
</div>

<div class="transactions-container" id="transactions"></div>

<div class="no-records" id="emptyMsg" style="display:none;">No transactions found</div>

<script>
  async function loadTransactions() {
    try {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Login required!");
        return;
      }

      const res = await fetch("http://localhost:5000/api/wallet/transactions", {
        headers: {
          "Authorization": "Bearer " + token
        }
      });

      const data = await res.json();

      if (!data.success) {
        document.getElementById("emptyMsg").style.display = "block";
        return;
      }

      // Set balance
      document.getElementById("balance").innerHTML = "₹" + data.balance;

      const container = document.getElementById("transactions");
      container.innerHTML = "";

   data.transactions.forEach(txn => {
  const amount = txn.amount;
  const type = txn.type;
  const date = new Date(txn.createdAt).toLocaleString();

  // ⭐ Title mapping
  let title = "";
  if (type === "deposit") title = "Deposit";
  else if (type === "withdrawal") title = "Withdrawal";
  else if (type === "tournament") title = "Tournament Joined";
  else if (type === "MATCH_REWARD") title = "Match Reward";
  else if (type === "winning") title = "Tournament Award";
  else if (type === "refund") title = "Refund";
  else title = type;

  // ⭐ Strict sign/color rules
  let sign = "+";
  let color = "#00ff99"; // green default

  if (type === "withdrawal" || type === "debit" || type === "tournament") {
    sign = "-";
    color = "#ff4444"; // red
  }

  // Deposit / Winning / Reward / Refund = green
  if (type === "deposit" || type === "winning" || type === "MATCH_REWARD" || type === "refund") {
    sign = "+";
    color = "#00ff99"; 
  }

  // Create UI
  const div = document.createElement("div");
  div.className = "transaction";

  div.innerHTML = `
    <div class="info">
      <div class="title">${title}</div>
      <div class="date">${date}</div>
    </div>
    <div class="amount" style="color:${color}">
      ${sign} ₹${amount}
    </div>
  `;

  container.appendChild(div);
});

    } catch (err) {
      console.error("Error loading transactions:", err);
    }
  }

  loadTransactions();
</script>

</body>
</html>
