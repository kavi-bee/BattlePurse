<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Zone - Live Tournaments</title>
<style>
/* Premium page loader overlay (smaller + cleaner) */
.page-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #010101, #0b0b0b, #111);
    animation: bgMove 7s infinite alternate ease-in-out;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Background animation */
@keyframes bgMove {
    0% { background-position: 0 0; }
    100% { background-position: 180% 180%; }
}

.page-loader .loader-box {
    text-align: center;
    animation: fadeIn 0.9s ease-out forwards;
}

/* Smaller logo */
.page-loader-logo {
    width: 55px;
    border-radius: 14px;
    box-shadow: 0 0 14px rgba(0,255,255,0.32);
    position: relative;
}

/* Shine effect (scaled down) */
.page-loader .shine {
    position: absolute;
    top: 0;
    left: -90px;
    width: 90px;
    height: 100%;
    background: linear-gradient(120deg, transparent, rgba(255,255,255,0.35), transparent);
    transform: skewX(-20deg);
    animation: shineMove 2s infinite;
}

@keyframes shineMove {
    0% { left: -90px; }
    100% { left: 120px; }
}

/* Smaller app title */
.page-loader-title {
    font-size: 16px;
    color: #00eaff;
    margin-top: 8px;
    letter-spacing: 0.8px;
    animation: glowPulse 2s infinite ease-in-out;
    text-shadow: 0 0 7px rgba(0,255,255,0.45);
}

@keyframes glowPulse {
    0%, 100% { text-shadow: 0 0 6px #00eaff; }
    50% { text-shadow: 0 0 12px #00eaff; }
}

/* Slimmer loading bar (smaller) */
.loader-bar {
    width: 115px;
    height: 4px;
    background: rgba(255,255,255,0.07);
    margin: 12px auto 0;
    border-radius: 50px;
    overflow: hidden;
    position: relative;
}

/* Smaller liquid animation */
.loader-liquid {
    width: 40px;
    height: 100%;
    border-radius: 50px;
    background: linear-gradient(90deg, #00eaff, #14ffec, #00b7ff);
    position: absolute;
    left: -45px;
    animation: slideLiquid 1.4s infinite ease-in-out;
}

@keyframes slideLiquid {
    0% { left: -45px; }
    100% { left: 140px; }
}

/* Fade out */
.hide-loader {
    opacity: 0;
    transition: opacity 0.55s ease;
    pointer-events: none;
}


* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0a0a0a; color: #fff; font-family: 'Poppins', sans-serif; padding-bottom: 80px; }

/* Navbar */
nav { position: fixed; top: 0; left: 0; width: 100%; background: #111; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.6); }
nav h1 { color: #00faff; font-size: 1.5rem; }

/* Promo Bar */
.promo-bar { position: fixed; top: 54px; left: 0; width: 100%; height: 90px; background: #111; display: flex; align-items: center; overflow: hidden; z-index: 999; }
.promo-track { display: flex; animation: scrollPromo 30s linear infinite; }
.promo-item { flex: 0 0 auto; margin: 0 20px; text-align: center; }
.promo-item img { width: 130px; height: 70px; object-fit: cover; border-radius: 10px; box-shadow: 0 0 8px #00faff70; }
@keyframes scrollPromo { from { transform: translateX(0); } to { transform: translateX(-50%); } }



/* Content */
.content, #promosContainer, #winningInfo { margin-top: 180px; padding: 20px; }
#filters { text-align: center; margin-bottom: 15px; }
#filters input, #filters select, #filters button { margin: 5px; padding: 6px; border-radius: 5px; border: none; cursor: pointer; }


 .game-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  padding: 10px;
}

/* Card style with glassy neon effect */
.game-card {
  background: #1c1c1c;
  padding: 15px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 0 20px #00faff60, 0 0 40px #ae00ff40;
  transition: transform 0.3s, box-shadow 0.3s;
  backdrop-filter: blur(5px);
}

/* Hover effect to make cards pop */
.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 25px #00faff80, 0 0 50px #ae00ff60;
}

/* Square image container with subtle inner shadow */
.game-img-box {
  width: 100%;
  aspect-ratio: 1 / 1;
  background: #000;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  box-shadow: inset 0 0 10px #00000080;
  transition: transform 0.3s;
}

/* Hover zoom effect on image container */
.game-card:hover .game-img-box {
  transform: scale(1.05);
}

/* Image fully visible with smooth transition */
.game-img-box img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: transform 0.3s;
}

/* Hover zoom effect on image itself */
.game-card:hover .game-img-box img {
  transform: scale(1.1);
}

/* Game title & description */
.game-card h3 {
  color: #ae00ff;
  margin: 10px 0 5px;
  text-shadow: 0 0 8px #ae00ff80;
}

.game-card p {
  font-size: 0.95rem;
  margin: 3px 0;
  color: #9ff;
}

/* Button style with neon glow */
.game-card button {
  background: linear-gradient(90deg, #ae00ff, #00faff);
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  margin: 5px 2px;
  box-shadow: 0 0 8px #00faff80, 0 0 12px #ae00ff60;
  transition: transform 0.2s, box-shadow 0.2s;
}

/* Button hover effect */
.game-card button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px #00faffc0, 0 0 20px #ae00ffc0;
}

/* Status text style */
#status {
  text-align: center;
  color: #9ff;
  margin-top: 15px;
  text-shadow: 0 0 10px #00faff70;
}




/* Latest Promos */
#promosContainer { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-left: 20px; }
.latest-promo { background: #1c1c1c; padding: 3px; border-radius: 8px; text-align: center; width: 85px; box-shadow: 0 0 5px #00faff40; transition: transform 0.2s ease; }
.latest-promo img { width: 100%; height: 55px; border-radius: 6px; object-fit: cover; }
.latest-promo:hover { transform: scale(1.05); }

.podium { display: flex; justify-content: center; align-items: flex-end; gap: 20px; margin-top: 20px; text-align: center; }
.podium-spot { background: #111; border-radius: 15px; padding: 15px; width: 160px; box-shadow: 0 0 10px #00faff44; transition: transform 0.3s; }
.podium-spot:hover { transform: translateY(-5px); }
.podium-spot img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #00faff; margin-bottom: 10px; }
.podium-1 { transform: translateY(-20px); }
.podium-2 { transform: translateY(-10px); }
.podium-3 { transform: translateY(0px); }

#walletBalance { text-align: center; margin-bottom: 25px; color: #00faff; font-weight: bold; }
.mode-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px; }
.mode-card { background: #121212; border-radius: 15px; padding: 20px; text-align: center; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; }
.mode-card:hover { transform: scale(1.05); box-shadow: 0 0 15px #00faff44; }
.mode-card h3 { color: #00faff; margin-bottom: 10px; }
.section { display: none; margin-top: 20px; text-align: center; }
.section.active { display: block; }

label { display: block; margin: 10px auto; width: 80%; text-align: left; }
select, input { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #00faff66; background: #121212; color: #fff; margin-top: 5px; }
button { padding: 10px 20px; border: none; border-radius: 8px; background: #00faff22; color: #00faff; cursor: pointer; margin: 10px; }
button:hover { background: #00faff44; }

.primary { background: #00d5ff; color: #000; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; }
.muted { background: #222; color: #aaa; border: none; padding: 8px 12px; border-radius: 8px; }

.message { margin-top: 15px; font-weight: bold; color: #00faff; white-space: pre-line; }

/* Live Winnings */
#winningInfo { margin: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.win-card { background: #1c1c1c; padding: 10px; border-radius: 10px; box-shadow: 0 0 10px #00faff40; text-align: center; }
.win-card h4 { color: #00faff; margin-bottom: 5px; }
.win-card p { font-size: 0.85rem; margin: 2px 0; }

/* Bottom Nav */
.sidebar { position: fixed; bottom: 0; left: 0; width: 100%; background: #111; display: flex; justify-content: space-around; padding: 8px 0; border-top: 1px solid #222; z-index: 1000; }
.nav-btn { flex: 1; text-align: center; color: #aaa; font-size: 12px; cursor: pointer; transition: 0.3s; }
.nav-btn i { display: block; font-size: 20px; margin-bottom: 3px; }
.nav-btn:hover { color: #fff; }
.nav-btn.active { color: #ffcc00; font-weight: bold; }

.winnerCard{
  background:#111; color:#fff; border:1px solid rgba(0,213,255,0.08);
  border-radius:10px; padding:12px; margin-bottom:12px; font-size:14px;
}
.winnerCard b{color:#00d5ff;}
.winnerCard .small{color:#9aa; font-size:12px;}

.winner-card {
  display: flex;
  background: #0f0f0f;
  border-radius: 10px;
  border: 1px solid #242424;
  margin-bottom: 20px;
  overflow: hidden;
  color: #fff;
}

.winner-sidebar {
  width: 260px;
  background: #111827;
  padding: 20px;
  border-right: 2px solid #333;
}

.winner-sidebar h3 {
  margin: 0 0 10px;
  color: #4ADE80;
}

.winner-list {
  flex: 1;
  padding: 20px;
}

.winner-row {
  display: flex;
  align-items: center;
  gap: 15px;
  background: #1a1a1a;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.winner-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 3px solid #4ade80;
  object-fit: cover;
}

.winner-name {
  font-size: 18px;
  margin-bottom: 3px;
}

.no-winner {
  color: #999;
  font-style: italic;
}

/* üîΩ Slide Down Animation */
/* ‚öîÔ∏è WAR THEME STICKY BAR */
/* Wrapper for scrolling */
/* ========== PREMIUM BAR ========== */
/* ===================== PREMIUM SCROLL BAR ===================== */
/* Wrapper for scrolling */
.premium-wrapper {
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  position: sticky;
  top: 60px;        /* keeps it under navbar */
  z-index: 999;
  padding: 5px 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(4px);
  border-bottom: 1px solid rgba(255, 0, 0, 0.4);
}

/* Text inside scrolling bar */
.premium-text {
  display: inline-block;
  font-size: 13px;
  padding-left: 100%; /* start from right side */
  animation: scrollLeft 12s linear infinite,
             glow 2s ease-in-out infinite alternate,
             gradientFlow 6s linear infinite;

  background: linear-gradient(90deg, #ff0000, #ff8800, #ffd500);
  -webkit-background-clip: text;
  color: transparent;
}

/* ‚û§ Right ‚Üí Left scrolling */
@keyframes scrollLeft {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* Glow effect */
@keyframes glow {
  from { text-shadow: 0 0 4px #ff4d4d; }
  to   { text-shadow: 0 0 10px #ff0000; }
}

/* Gradient Flow */
@keyframes gradientFlow {
  0%   { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* Mobile Only Fixes */
@media (max-width: 480px) {
  .premium-wrapper {
    top: 65px;
    padding: 4px 0;
  }
  .premium-text {
    font-size: 12px;
  }
}




/* ========== 1. PREMIUM BAR ========== */
.premium-wrapper {
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  position: sticky;
  top: 60px;
  z-index: 999;
  padding: 5px 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(4px);
  border-bottom: 1px solid rgba(255, 0, 0, 0.4);
}

.premium-text {
  display: inline-block;
  padding-left: 100%;
  font-size: 13px;
  animation: scrollLeft 12s linear infinite,
             glow 2s ease-in-out infinite alternate,
             gradientFlow 6s linear infinite;
  background: linear-gradient(90deg, #ff0000, #ff8800, #ffd500);
  -webkit-background-clip: text;
  color: transparent;
}

/* ========== 2. SUPPORT BAR ========== */
.support-wrapper {
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  position: sticky;
  top: 90px; /* appears directly under the premium bar */
  z-index: 998;
  padding: 4px 0;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(0, 255, 255, 0.4);
}

.support-text {
  display: inline-block;
  padding-left: 100%;
  font-size: 12px;
  animation: scrollLeft 14s linear infinite,
             blueGlow 2s ease-in-out infinite alternate;
  
  background: linear-gradient(90deg, #00ffee, #0099ff, #0055ff);
  -webkit-background-clip: text;
  color: transparent;
}

/* ========== SCROLLING ========== */
@keyframes scrollLeft {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

/* Premium glow */
@keyframes glow {
  from { text-shadow: 0 0 4px #ff4d4d; }
  to   { text-shadow: 0 0 10px #ff0000; }
}

/* Support bar glow */
@keyframes blueGlow {
  from { text-shadow: 0 0 4px #00e6ff; }
  to   { text-shadow: 0 0 10px #008cff; }
}

@keyframes gradientFlow {
  0%   { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* ========== Mobile Friendly ========== */
@media (max-width: 480px) {
  .premium-wrapper { top: 60px; }
  .premium-text { font-size: 12px; }

  .support-wrapper { top: 88px; }
  .support-text { font-size: 11px; }
}

/* ========== PREMIUM SCROLLING BAR ========== */
.premium-wrapper {
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  position: sticky;
  top: 60px;
  z-index: 999;
  padding: 6px 0;
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(4px);
  border-bottom: 1px solid rgba(255, 0, 0, 0.4);
}

.premium-text {
  display: inline-block;
  padding-left: 100%;
  font-size: 13px;

  animation: scrollLeft 12s linear infinite,
             glow 2s ease-in-out infinite alternate,
             gradientFlow 6s linear infinite;

  background: linear-gradient(90deg, #ff0000, #ff8800, #ffd500);
  -webkit-background-clip: text;
  color: transparent;
}

/* SCROLL ANIMATION */
@keyframes scrollLeft {
  from { transform: translateX(0); }
  to { transform: translateX(-100%); }
}

/* Glow */
@keyframes glow {
  from { text-shadow: 0 0 4px #ff4d4d; }
  to   { text-shadow: 0 0 10px #ff0000; }
}

/* Gradient Flow */
@keyframes gradientFlow {
  0%   { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* ========== SUPPORT BUTTON BELOW ========== */
.support-btn-wrapper {
  position: sticky;
  top: 95px;  
  width: 100%;
  z-index: 998;
  display: flex;
  justify-content: center;
  padding: 6px 0;
  background: rgba(0, 0, 0, 0.35);
  border-bottom: 1px solid rgba(0, 255, 255, 0.4);
}

.support-btn {
  font-size: 13px;
  font-weight: 600;
  padding: 6px 16px;
  border-radius: 20px;
  text-decoration: none;
  background: linear-gradient(90deg, #00d4ff, #007bff);
  color: #fff;
  box-shadow: 0px 0px 6px rgba(0, 195, 255, 0.7);
  transition: 0.2s ease;
}

.support-btn:active {
  transform: scale(0.95);
}

.support-btn:hover {
  filter: brightness(1.15);
}

/* ========== MOBILE SAFE ========== */
@media (max-width: 480px) {
  .premium-wrapper { top: 60px; }
  .premium-text { font-size: 12px; }

  .support-btn-wrapper { top: 90px; }
  .support-btn { font-size: 12px; padding: 5px 14px; }
} 

/* ===============================
   GLOBAL THEME
   =============================== */
:root{
  --bg: #06070a;
  --panel: #0f1720;
  --muted: #9aa4b2;
  --accent: #00eaff;
  --accent-2: #6ee7b7;
  --danger: #ff6b6b;
  --success: #4ade80;
  --input: #0b1220;
  --glass: rgba(255,255,255,0.03);
}

/* ===============================
   BASE
   =============================== */
*{ box-sizing:border-box; }

body{
  margin:0;
  background: radial-gradient(1200px 600px at 10% 10%, rgba(0,213,255,0.04), transparent),
              linear-gradient(180deg,#020204 0%, #071018 100%);
  color:#dfeefc;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
  padding:18px;
  min-height:100vh;
}

/* ===============================
   LAYOUT  (NOW VERTICAL)
   =============================== */
.container{
  width:100%;
  max-width:880px;
  display:flex;
  flex-direction:column;   /* üî• Full vertical layout */
  gap:20px;
  margin:0 auto;
}

.card, .panel{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 8px 40px rgba(1,7,18,0.6);
  padding:18px;
}

/* ===============================
   BRAND HEADER
   =============================== */
.brand{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:10px;
}
.logo{
  width:48px;height:48px;border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  box-shadow:0 6px 18px rgba(0,0,0,0.6);
}
h1{ font-size:20px; margin:0; }
p.lead{ margin:6px 0 0; color:var(--muted); font-size:13px; }

/* ===============================
   MODE SELECTION
   =============================== */
.modes{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap:12px;
  margin-top:16px;
}

.mode-tile{
  background:var(--glass);
  border-radius:10px;
  padding:12px;
  text-align:center;
  cursor:pointer;
  transition:0.15s ease;
  border:1px solid rgba(255,255,255,0.02);
}
.mode-tile:hover{
  transform:translateY(-4px);
  box-shadow: 0 12px 36px rgba(0,0,0,0.6);
}
.mode-tile h3{
  margin:0;
  color:var(--accent);
}
.mode-tile p{
  margin:6px 0 0;
  color:var(--muted);
  font-size:12px;
}

/* ===============================
   FORM
   =============================== */
.panel h2{
  margin:0 0 6px;
  font-size:16px;
  color:var(--accent);
}
.panel p.desc{
  margin:0 0 14px;
  color:var(--muted);
  font-size:13px;
}

label{
  display:block;
  font-size:13px;
  color:var(--muted);
  margin-top:12px;
}

input[type=text], 
input[type=number], 
select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.04);
  background:var(--input);
  color:#dfeefc;
  font-size:14px;
  margin-top:6px;
}

.inline{
  display:flex;
  gap:8px;
}
.inline input, .inline select{ flex:1; }

/* ===============================
   FREE FIRE SETTINGS SECTION
   =============================== */
.ff-settings{
  margin-top:10px;
  padding:12px;
  border-radius:10px;
  background:rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.01);
  display:none;
}

.guns{
  max-height:220px;
  overflow:auto;
  padding:8px;
  display:none;
  border-radius:8px;
  background:rgba(255,255,255,0.01);
  border:1px solid rgba(255,255,255,0.02);
  margin-top:8px;
}

.gun-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.gun-row label{
  font-size:13px;
  padding:6px 10px;
  border-radius:8px;
  color:#cfe9ff;
  border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;
}

/* ===============================
   BUTTONS
   =============================== */
.controls{
  display:flex;
  gap:12px;
  margin-top:16px;
}
.btn{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
}
.btn-primary{
  background: linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#022026;
  box-shadow: 0 8px 30px rgba(0,213,255,0.06);
}
.btn-ghost{
  background:transparent;
  color:var(--muted);
  border:1px solid rgba(255,255,255,0.04);
}

/* ===============================
   MESSAGES
   =============================== */
.message{
  margin-top:14px;
  font-weight:700;
  text-align:center;
  color:var(--danger);
}
.message.ok{
  color:var(--success);
}

/* ===============================
   MOBILE OPTIMIZED
   =============================== */
@media (max-width:600px){

  body{
    padding:14px;
  }

  .card, .panel{
    padding:16px;
  }

  .modes{
    grid-template-columns: repeat(2, 1fr); /* Good for mobile */
    gap:10px;
  }

  h1{
    font-size:18px;
  }

  input, select{
    font-size:13px;
    padding:9px;
  }

  .controls{
    flex-direction:column;
  }

  .btn{
    width:100%;
  }
}


/* ACTIVE MATCH UI */
.active-box {
  margin-top: 25px;
  display: none;
}

.active-box h3 {
  font-size: 20px;
  margin-bottom: 10px;
  color: #00d5ff;
}

.active-content {
  background: #131313;
  padding: 15px;
  border-radius: 12px;
  line-height: 1.55;
  font-size: 15px;
  border: 1px solid #222;
}

.active-content p {
  margin: 6px 0;
}

.active-content button {
  margin-top: 15px;
  padding: 10px 14px;
  border: none;
  border-radius: 10px;
  background: #00d5ff;
  color: #000;
  font-weight: 600;
  width: 100%;
  cursor: pointer;
  transition: 0.2s;
}

.active-content button:hover {
  background: #04bfe4;
}


/* üéñ TOURNAMENT LEADERBOARD UI */

.tl-title {
  color: #ffcc00;
  margin-bottom: 10px;
  font-size: 22px;
}

.tl-select {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  background: #0f0f0f;
  border: 1px solid #222;
  color: #fff;
  margin-top: 8px;
}

.tl-btn {
  margin-top: 12px;
  width: 100%;
  padding: 10px;
  background: #00d5ff;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  color: #000;
  cursor: pointer;
  transition: 0.2s;
}

.tl-btn:hover {
  background: #04c0e6;
}

.tl-container {
  margin-top: 20px;
  padding: 10px;
  background: #111;
  border-radius: 10px;
  border: 1px solid #222;
  color: #fff;
}

.tl-top-card {
  background: #131313;
  padding: 12px;
  border-radius: 12px;
  width: 130px;
  text-align: center;
  border: 1px solid #1f1f1f;
}

.tl-top-card img {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  border: 3px solid #00faff;
}

.tl-top-wrapper {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 10px;
}

</style>
</head>
<body>
<div class="page-loader" id="pageLoader">
    <div class="loader-box">
        <div style="position: relative; display:inline-block;">
            <img src="file_00000000c938722f8d26b428d0c8069c.png" class="page-loader-logo">
            <div class="shine"></div>
        </div>

        <h2 class="loader-text">Loading Game Zone</h2>

        <div class="loader-bar">
            <div class="loader-liquid"></div>
        </div>
    </div>
</div>

<nav><h1>Game Zone</h1><div id="navRight"></div></nav>

<div class="promo-bar"><div id="promoTrack" class="promo-track"></div></div>

<div class="hero"><h2>üî• Latest Promos üî•</h2></div>
<div id="promosContainer"></div>
<div class="premium-wrapper">
  <span class="premium-text">
    Welcome to GameZone! Play daily tournaments & matches, win prizes, climb the leaderboard. 
    Note: Never use hacks ‚Äî if detected, winnings will not be shared.
  </span>
</div>
<div class="support-wrapper">
  <span class="support-text">
    Facing any issue? Game problem, payment delay, or match error ‚Äî contact us on Help & Support page: help&support
  </span>
</div>

<div class="support-btn-wrapper">
  <a href="help&support.html" class="support-btn">Help & Support</a>
</div>


<h2 style="padding:10px; color:#ae00ff;">üèÜ Live Member Winnings</h2>

<!-- üéØ Live Leaderboard Section -->
<section id="leaderboardSection">
  <!-- Add this inside your <body>, maybe as a sidebar or at top-right corner -->
<div id="winnerSidebar" style="position:fixed; top:80px; right:20px; width:280px; max-height:80vh; overflow-y:auto; z-index:999;">
  <h3 style="color:#00d5ff; text-align:center; margin-bottom:10px;"></h3>
  <div id="winnerList"></div>
</div>

<div id="matches" style="max-width:700px;margin:auto;"></div>

  <!-- ‚≠ê Tournament Leaderboard -->
<section id="tournamentLeaderboardSection" style="margin-top:35px;">
  <h2 class="tl-title">üèÖ Tournament Leaderboard</h2>

  <select id="leaderboardSelect" class="tl-select">
    <option value="">Select Tournament</option>
  </select>

  <button id="leaderboardBtn" class="tl-btn" onclick="loadLeaderboard()">
    View Leaderboard
  </button>

  <div id="leaderboardContainer" class="tl-container"></div>
</section>


<div class="content">
  <div id="filters">
    <input type="text" id="gameFilter" placeholder="Game name">
    <input type="text" id="modeFilter" placeholder="Mode (Solo/Duo/Squad)">
    <input type="date" id="dateFilter">
    <input type="number" id="entryFeeFilter" placeholder="Max Entry Fee">
    <button onclick="loadTournaments()">Apply Filters</button>
  </div>
  <div id="status"></div>
  <div class="game-grid" id="gameGrid"></div>
</div>

<div class="sidebar">
  <div class="nav-btn active" onclick="location.href='gamezone.html'"><i>üéÆ</i><span>Game</span></div>
  <div class="nav-btn" onclick="location.href='history.html'"><i>üìú</i><span>History</span></div>
  <div class="nav-btn" onclick="location.href='leaderboard.html'"><i>üèÜ</i><span>Leaderboard</span></div>
  <div class="nav-btn" onclick="location.href='profile.html'"><i>üë§</i><span>Profile</span></div>
  <div class="nav-btn" onclick="location.href='more.html'"><i>‚ãØ</i><span>More</span></div>
</div>

<div id="walletBalance">Fetching wallet balance...</div>
<!-- HTML -->
  <h1>Quick Match ‚Äî Join</h1>

<!-- Game Cards -->
<div class="game-grid" id="gameGrid">
  <div class="game-card" data-game="Ludo">
    <img src="images (2).jpeg" alt="Ludo" width="64" height="64" />
    <h3>Ludo</h3>
  </div>

  <div class="game-card" data-game="Carrom">
    <img src="unnamed (3).png" alt="Carrom" width="64" height="64" />
    <h3>Carrom</h3>
  </div>

  <div class="game-card" data-game="8 Ball Pool">
    <img src="unnamed (2).png" alt="8 Ball Pool" width="64" height="64" />
    <h3>8 Ball Pool</h3>
  </div>

  <div class="game-card" data-game="Cricket">
    <img src="IMG_20251217_225322.jpg" alt="Cricket" width="64" height="64" />
    <h3>Cricket</h3>
  </div>
</div>

<!-- Join Form -->
<div class="join-panel">
  <h2 id="selectedTitle" style="margin:0 0 12px">Pick a game to start</h2>

  <div id="formArea" style="display:none">
    <div class="form-row">
      <label>Match Type</label>
      <select id="matchType"></select>
    </div>

    <div class="form-row">
      <label>Mode</label>
      <select id="matchMode"></select>
    </div>

    

<div class="form-row">
  <label>Entry Fee (‚Çπ)</label>

  <select id="fee" onchange="toggleCustomFee()">
    <option value="50">‚Çπ50</option>
    <option value="100">‚Çπ100</option>
    <option value="150">‚Çπ150</option>
    <option value="200">‚Çπ200</option>
    <option value="custom">Custom</option>
  </select>

  <!-- hidden by default -->
  <input 
    type="number" 
    id="entryFee" 
    placeholder="Enter custom fee" 
    min="50" 
    style="display:none; margin-top:8px;" 
  />
</div>

    



<div class="form-row">
      <label id="gameUIDLabel">Game UID</label>
      <input type="text" id="gameUID" placeholder="Enter your in-game UID" />
    </div>
    

<!-- ‚≠ê Cricket-only note -->
<div id="cricketNote" style="display:none; color:orange; font-size:14px; margin-top:6px;">
  ‚ö† Level 3 is required to join Cricket matches.
</div>

    <div class="form-row">
      <label>WhatsApp Number</label>
      <input type="text" id="whatsapp" placeholder="Enter WhatsApp number (digits only)" />
    </div>

    <!-- Download Game Button -->
<button class="btn" id="downloadGameBtn" style="margin-top:10px; display:none;">
  Download Game
</button>


    <button class="btn" id="joinBtn">Join Match</button>
    <div class="msg" id="message"></div>
    <div class="inline-note">This client will send both top-level <code>whatsappNumber</code> and a <code>slots</code> array to match backend variants.</div>
  </div>
</div>

<!-- ACTIVE MATCH SECTION -->


<!-- ACTIVE MATCH SECTION -->
<div id="activeMatchBox" class="active-box">
  <h3>Your Active Match</h3>
  <div id="activeMatchContent" class="active-content"></div>
</div>


 <div class="container">
    <!-- Left: selection -->
    <div class="card">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>BGMI & Free Fire Match War</h1>
          <p class="lead">Pick match size, choose winning system for team matches, then configure settings and join.</p>
        </div>
      </div>

      <div class="modes" id="modeSection" aria-label="Match types">
        <div class="mode-tile" onclick="openMatchForm('1v1')"><h3>1v1</h3><p>Solo vs Solo</p></div>
        <div class="mode-tile" onclick="openMatchForm('2v2')"><h3>2v2</h3><p>Duo Battles</p></div>
        <div class="mode-tile" onclick="openMatchForm('3v3')"><h3>3v3</h3><p>Triple Team War</p></div>
        <div class="mode-tile" onclick="openMatchForm('4v4')"><h3>4v4</h3><p>Squad Fight</p></div>
      </div>

      <div style="margin-top:14px">
        <div id="prizeSystemSection" style="display:none;text-align:center">
          <h3 style="margin:0 0 8px;color:var(--muted)">Select Winning System</h3>
          <div class="modes" style="grid-template-columns:repeat(2,1fr);">
            <div class="mode-tile" onclick="selectPrizeSystem('kill_based')"><h3>Kill-Based</h3><p>Prize by kills</p></div>
            <div class="mode-tile" onclick="selectPrizeSystem('team_equal')"><h3>Team Equal</h3><p>Split equally</p></div>
          </div>
          <div style="margin-top:10px;text-align:center;">
            <button class="btn btn-ghost" onclick="backToModes()">‚¨Ö Back</button>
          </div>
        </div>
      </div>

      <div class="small-note">More updates coming soon ‚Äî optimized for mobile and desktop.</div>
    </div>

    <!-- Right: form -->
    <div class="panel" role="region" aria-labelledby="join-title">
      <h2 id="join-title">Join Match</h2>
      <p class="desc">When you pick Free Fire you'll see additional game settings and a full gun selection for advanced rooms.</p>

      <form id="matchForm" onsubmit="return false;" aria-describedby="form-help">
        <input type="hidden" id="type" />
        <input type="hidden" id="prizeSystem" />



<label>Game</label>
<select id="game" onchange="updateGameOptions()">
  <option value="">Select Game</option>
  
  <option value="Free Fire">Free Fire</option>
  <option value="BGMI">BGMI (Coming Soon)</option>
</select>

        

        <label>Mode</label>
        <select id="mode" onchange="updateMapOptions()"></select>

        <div id="mapSection" style="display:none">
          <label>Map</label>
          <select id="map"></select>
        </div>

        <div id="freeFireFields" class="ff-settings" aria-hidden="true">
          <label>Headshot</label>
          <select id="headshot">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>

          <label>Character Skill</label>
          <select id="characterSkill">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>

          <label>Gun Attributes</label>
          <select id="gunAttributes">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>

          <label>Throwable Limit</label>
          <select id="throwableLimit">
            <option value="true">Yes</option>
            <option value="false">No</option>
          </select>

          <label>Room Type</label>
          <select id="roomType" onchange="toggleGunSelection()">
            <option value="Regular">Regular</option>
            <option value="Advance">Advance</option>
          </select>

          <div id="gunSelection" class="guns" aria-hidden="true" aria-label="Gun selection (Advance)">
            <div id="gunsList" class="gun-row" role="list"></div>
          </div>
        </div>

        <label>Game UID</label>
        <input id="uid" type="text" placeholder="Enter your game UID" />

        <label>WhatsApp number</label>
        <div class="inline">
          <select id="countryCode">
            <option value="+91">+91 (India)</option>
            <option value="+1">+1 (USA)</option>
            <option value="+44">+44 (UK)</option>
            <option value="+61">+61 (AUS)</option>
          </select>
          <input id="whatsappNumber" type="text" placeholder="e.g. 9876543210" />
        </div>

        <label>Entry fee</label>
        <div style="display:flex;gap:8px">
          <select id="fee" onchange="toggleCustomFee()">
            <option value="50">‚Çπ50</option>
            <option value="100">‚Çπ100</option>
            <option value="150">‚Çπ150</option>
            <option value="200">‚Çπ200</option>
            <option value="custom">Custom</option>
          </select>
          <input id="customFee" type="number" min="50" placeholder="Custom (min ‚Çπ50)" style="display:none"/>
        </div>

        <div class="controls">
          <button class="btn btn-primary" onclick="joinMatch()">Join Match</button>
          <button type="button" class="btn btn-ghost" onclick="showHome()">Cancel</button>
        </div>

        <div id="form-message" class="message" role="status" aria-live="polite"></div>
        <div id="form-help" class="small-note" style="margin-top:10px;color:var(--muted)">Prize system is selected in the left panel for team matches.</div>
      </form>
    </div>
  </div>


<div class="update-note">
  More updates coming soon. Thank you for being with us.
</div>


<script>
const API_BASE = "http://localhost:5000/api/wallet";
const token = localStorage.getItem('token');
const UPLOADS_BASE = "http://localhost:5000/uploads";
const BACKEND_URL = API_BASE;





/*
  CLEAN HYBRID JS for gamezone.html ‚Äî Final (Option C)
  - Ensures loadTournaments() and fetchWalletBalance() exist before we capture preserved
  - Prevents null errors and gracefully falls back
  - Exposes functions used by inline onclick handlers
  - Shows guns only when Room Type === "Advance"
*/

(() => {
  /* ------------- Config ------------- */
  const API_BASE = (typeof BACKEND_URL !== 'undefined' && BACKEND_URL) ? BACKEND_URL : "http://localhost:5000/api/wallet";
  const TOKEN = localStorage.getItem('token') || "";

  /* ------------- Simple helpers ------------- */
  const $ = id => document.getElementById(id);
  function safeCall(fn){ try { return fn && fn(); } catch(e) { console.warn('safeCall error', e); } }
  function isEl(el){ return el instanceof Element || el instanceof HTMLDocument; }
  function show(el){ if(!isEl(el)) return; el.style.display = ''; }
  function hide(el){ if(!isEl(el)) return; el.style.display = 'none'; }
  function formatDateTime(v){ if(!v) return ''; const d = new Date(v); return isNaN(d) ? String(v) : d.toLocaleString(); }

  async function safeFetchJson(url, opts = {}) {
    try {
      const res = await fetch(url, opts);
      const txt = await res.text().catch(()=>'');
      let json = {};
      try { json = txt ? JSON.parse(txt) : {}; } catch(e){ json = { success:false, msg: txt || 'Invalid JSON' }; }
      return { ok: res.ok, status: res.status, json };
    } catch (err) {
      return { ok:false, status:0, json:{ success:false, msg: err.message || 'Network error' } };
    }
  }

  /* ------------- UI safe setter ------------- */
  function setMessageEl(msg, isError=true){
    const el = $('form-message') || $('message');
    if(!el) return;
    el.textContent = msg || '';
    el.style.color = isError ? (getComputedStyle(document.documentElement).getPropertyValue('--danger') || 'red') : (getComputedStyle(document.documentElement).getPropertyValue('--success') || '#4ade80');
    if(!msg) el.classList.remove('ok'); else if(!isError) el.classList.add('ok');
  }

  /* ------------- Wallet balance (DEFINED BEFORE preserved) ------------- */
  async function fetchWalletBalance(){
    const walletDiv = $('walletBalance');
    if(!walletDiv) return; // no UI to update
    if(!TOKEN){
      walletDiv.textContent = 'üí∞ Wallet Balance: (login required)';
      return;
    }
    try{
      const res = await fetch(`${API_BASE}/balance`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json', ...(TOKEN ? { Authorization: 'Bearer ' + TOKEN } : {}) }
      });
      if(!res.ok) throw new Error('fetch failed');
      const data = await res.json().catch(()=>({}));
      const bal = (data && (data.balance ?? data.data?.balance ?? null));
      walletDiv.textContent = `üí∞ Wallet Balance: ‚Çπ${(bal != null) ? bal : 0}`;
    } catch(e){
      console.error('wallet fetch err', e);
      walletDiv.textContent = '‚ö† Failed to fetch wallet balance';
    }
  }

  /* ------------- Load tournaments (DEFINED BEFORE preserved) ------------- */
  async function loadTournaments(){
    // Support both "tournamentList" and "gameGrid" containers if present.
    const status = $('status') || null;
    const listBox = $('tournamentList') || $('gameGrid') || null;
    if(status) status.textContent = 'Loading tournaments...';
    if(!listBox){
      console.warn('No tournament container found (#tournamentList or #gameGrid)');
      if(status) status.textContent = 'No tournaments container';
      return;
    }
    listBox.innerHTML = `<div style="padding:12px;color:var(--muted,#9aa)">Loading tournaments‚Ä¶</div>`;

    try {
      const { ok, json } = await safeFetchJson(`${API_BASE}/tournaments`, { method: 'GET', headers: { 'Content-Type':'application/json', ...(TOKEN?{ Authorization: 'Bearer '+TOKEN }:{}) } });
      if(!ok || !json) throw new Error(json?.msg || 'Fetch error');

      // Accept either { success: true, tournaments: [...] } OR directly an array
      const tournaments = Array.isArray(json) ? json : (Array.isArray(json.tournaments) ? json.tournaments : (json.data && Array.isArray(json.data.tournaments) ? json.data.tournaments : []));

      if(!tournaments || tournaments.length === 0){
        listBox.innerHTML = `<div style="padding:12px;color:var(--muted,#9aa)">No tournaments available</div>`;
        if(status) status.textContent = 'No tournaments';
        return;
      }

      // render each tournament card ‚Äî keep styling minimal so your CSS remains unchanged
      listBox.innerHTML = '';
      tournaments.forEach(t => {
        const div = document.createElement('div');
        div.className = 'game-card';
        // poster fallback handling
        const posterUrl = t.poster ? ((typeof UPLOADS_BASE !== 'undefined' ? UPLOADS_BASE : (window.UPLOADS_BASE || '')) + '/' + t.poster) : (t.posterUrl || '');
        const posterImg = posterUrl ? `<img src="${posterUrl}" alt="Poster" style="width:100%;height:180px;object-fit:cover;border-radius:8px 8px 0 0;">` : '';
        const joined = Array.isArray(t.joinedUsers) ? t.joinedUsers.length : (t.joinedCount ?? 0);
        div.innerHTML = `
          ${posterImg}
          <div style="padding:12px">
            <h3 style="margin:0 0 6px">${t.name || t.title || 'Untitled'}</h3>
            <div style="font-size:13px;color:var(--muted,#9aa);margin-bottom:6px">${t.game || ''} ‚Äî ${t.mode || ''}</div>
            <div style="font-size:13px;color:var(--muted,#9aa);margin-bottom:6px">Entry: ‚Çπ${t.entryFee ?? (t.fee ?? 0)} ‚Ä¢ Prize: ‚Çπ${t.prizePool ?? (t.prize ?? 0)}</div>
            <div style="font-size:13px;color:var(--muted,#9aa);margin-bottom:8px">${joined}/${t.maxPlayers ?? 'N/A'} players</div>
            <div style="font-size:13px;color:var(--muted,#9aa);margin-bottom:10px">
  Starts: ${formatTournamentDateTime(t.date, t.time)}
</div>

            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-primary" onclick="joinTournament && joinTournament('${t._id ?? t.id}')">Join</button>
              ${ (t.roomUploaded || t.roomInfo?.roomId || t.roomId || t.resultsUploaded) ? `<button disabled style="opacity:0.5;cursor:not-allowed;">Leave Locked üîí</button>` : `<button class="btn btn-ghost" onclick="leaveTournament && leaveTournament('${t._id ?? t.id}')">Leave</button>` }
              <button class="btn btn-ghost" onclick="viewTournament && viewTournament('${t._id ?? t.id}')">View</button>
            </div>
          </div>
        `;
        listBox.appendChild(div);
      });

      if(status) status.textContent = 'Loaded tournaments';
    } catch(err){
      console.error('Load tournaments error:', err);
      listBox.innerHTML = `<div style="padding:12px;color:#f66">Failed to load tournaments</div>`;
      if(status) status.textContent = 'Failed to load tournaments';
    }
  }

  async function viewTournament(id) {
  try {
    const token = localStorage.getItem("token");

    const res = await fetch(`${API_BASE}/tournament/${id}`, {
      headers: token ? { Authorization: "Bearer " + token } : {}
    });

    const t = await res.json();

    if (!res.ok) {
      alert(t.msg || "Failed to load tournament");
      return;
    }

    // Format date + time safely (NO timezone conversion)
    const startTime = formatTournamentDateTime(t.date, t.time);

    // User must join to see room details
    if (!t.joined) {
      alert(
        `Tournament: ${t.name}\n` +
        `Game: ${t.game}\n` +
        `Starts: ${startTime}\n\n` +
        `‚ùå Join the tournament to see room details`
      );
      return;
    }

    // Room info (after admin upload)
    const roomId = t.roomInfo?.roomId || "Not uploaded yet";
    const roomPass = t.roomInfo?.roomPassword || "Not uploaded yet";

    alert(
      `üèÜ Tournament Details\n\n` +
      `Name: ${t.name}\n` +
      `Game: ${t.game}\n` +
      `Mode: ${t.mode}\n` +
      `Starts: ${startTime}\n\n` +
      `üéÆ ROOM DETAILS\n` +
      `Room ID: ${roomId}\n` +
      `Password: ${roomPass}`
    );

  } catch (err) {
    console.error("View tournament error:", err);
    alert("Failed to view tournament details");
  }
}


  function formatTournamentDateTime(dateStr, timeStr) {
  if (!dateStr) return "TBA";

  // If admin entered time, show exact time (NO timezone conversion)
  if (timeStr && timeStr.trim() !== "") {
    return `${dateStr} ‚Ä¢ ${timeStr}`;
  }

  // If time missing, show only date
  return dateStr;
}  


  /* ------------- Fallback & preserved functions capture ------------- */
  const preserved = {
    loadPromos: (typeof window.loadPromos === 'function') ? window.loadPromos : () => {},
    loadTournaments: (typeof window.loadTournaments === 'function') ? window.loadTournaments : loadTournaments, // prefer earlier window fn, fallback to ours
    fetchWinners: (typeof window.fetchWinners === 'function') ? window.fetchWinners : () => {},
    renderMatch: (typeof window.renderMatch === 'function') ? window.renderMatch : () => {},
    fetchWalletBalance: (typeof window.fetchWalletBalance === 'function') ? window.fetchWalletBalance : fetchWalletBalance // prefer earlier, fallback to ours
  };

  /* ------------- Constants (modes, maps, guns) ------------- */
  // UI state
let selectedType = '';
let selectedPrizeSystem = null;

// lists

const BGMI_MODES = ["TDM", "Gun Game"];

const FF_MODES = ["Clash Squad", "Lone Wolf"];
const CLASH_SQUAD_MAPS = ["Bermuda", "Alpine", "Kalahari", "Purgatory", "Nexterra"];
const LONE_WOLF_MAPS = ["Iron Cage"];

// full gun list
const GUNS_FULL = [
  "AK","M4A1","SCAR","GROZA","FAMAS","AN94","XM8","M14","PARAFAL","KINGFISHER","AUG","AC80",
  "MP40","MP5","UMP","VSS","THOMPSON","VECTOR","BIZON","UZI","MAC10",
  "AWM","KAR98K","M82B","M24","SVD","SKS","WOODPECKER",
  "M1014","M1887","MAG7","SPAS12","Trogon",
  "USP","G18","M500","Desert Eagle","Treatment Pistol","Hand Cannon",
  "M79","RGS50","MGL140",
  "Plasma Gun","Laser Gun (CS)","CG15","Crossbow","Flame Bow"
];

// DOM refs
const modeSection = document.getElementById('modeSection');
const prizeSystemSection = document.getElementById('prizeSystemSection');
const formMessage = document.getElementById('form-message');

const gameEl = document.getElementById('game');
const modeEl = document.getElementById('mode');
const mapSection = document.getElementById('mapSection');
const mapEl = document.getElementById('map');

const freeFireFields = document.getElementById('freeFireFields');
const roomTypeEl = document.getElementById('roomType');
const gunSelection = document.getElementById('gunSelection');
const gunsList = document.getElementById('gunsList');

const uidEl = document.getElementById('uid');
const countryCodeEl = document.getElementById('countryCode');
const whatsappEl = document.getElementById('whatsappNumber');

const feeEl = document.getElementById('fee');
const customFeeEl = document.getElementById('customFee');

// small helpers
function show(el){ if(!el) return; el.style.display = 'block'; }
function hide(el){ if(!el) return; el.style.display = 'none'; }
function setMessage(txt, danger=true){
  formMessage.textContent = txt || '';
  if(!txt) return;
  formMessage.classList.toggle('ok', !danger);
  formMessage.style.color = danger ? getComputedStyle(document.documentElement).getPropertyValue('--danger') : getComputedStyle(document.documentElement).getPropertyValue('--success');
}

// Flow: pick mode -> (if team) pick prize -> fill form
function openMatchForm(type){
  selectedType = type;
  document.getElementById('type').value = type;
  // hide left selections, show prize if needed
  hide(modeSection);
  if(type === '1v1'){
    selectedPrizeSystem = 'kill_based';
    document.getElementById('prizeSystem').value = selectedPrizeSystem;
    showForm();
  } else {
    show(prizeSystemSection);
  }
}
function selectPrizeSystem(ps){
  selectedPrizeSystem = ps;
  document.getElementById('prizeSystem').value = ps;
  hide(prizeSystemSection);
  showForm();
}
function backToModes(){
  hide(prizeSystemSection);
  show(modeSection);
}
function showHome(){
  selectedType = '';
  selectedPrizeSystem = null;
  document.getElementById('type').value = '';
  document.getElementById('prizeSystem').value = '';
  hide(document.querySelector('.panel') /* not required but keep */);
  // reset form UI and navigate client-side:
  // redirect or just show selection again:
  show(modeSection);
  setMessage('');
  // Make sure form visible (panel isn't hidden in markup)
  // there's no special hide for the right panel; user can fill again.
}
function showForm(){
  // reveal/upadte form data
  updateGameOptions();
  setMessage('');
  // ensure right panel visible ‚Äî it's always visible in layout; just remove any stale message
  // Put a small title update
  const title = document.getElementById('join-title');
  title.textContent = selectedType ? `Join ${selectedType} Match` : 'Join Match';
  // scroll to form on small screens
  window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
}

// Game / mode / map logic
function updateGameOptions(){
  const g = gameEl.value;
  modeEl.innerHTML = '';
  mapEl.innerHTML = '';
  if(g === 'BGMI' || g === 'PUBG'){
    BGMI_PUBG_MODES.forEach(m => {
      const o = document.createElement('option'); o.value = m; o.textContent = m; modeEl.appendChild(o);
    });
    hide(freeFireFields);
    hide(mapSection);
  } else if(g === 'Free Fire'){
    FF_MODES.forEach(m => {
      const o = document.createElement('option'); o.value = m; o.textContent = m; modeEl.appendChild(o);
    });
    show(freeFireFields);
    show(mapSection);
  } else {
    hide(freeFireFields);
    hide(mapSection);
  }
  updateMapOptions();
  toggleGunSelection(); // reset gun UI
}

function updateMapOptions(){
  const g = gameEl.value;
  const m = modeEl.value;
  mapEl.innerHTML = '';
  if(g !== 'Free Fire'){
    hide(mapSection);
    return;
  }
  show(mapSection);
  let maps = [];
  if(m === 'Clash Squad') maps = CLASH_SQUAD_MAPS;
  if(m === 'Lone Wolf') maps = LONE_WOLF_MAPS;
  maps.forEach(mp => {
    const o = document.createElement('option'); o.value = mp; o.textContent = mp; mapEl.appendChild(o);
  });
}

function toggleGunSelection(){
  if(roomTypeEl.value === 'Advance'){
    show(gunSelection);
    // render all guns grouped
    gunsList.innerHTML = '';
    const grouped = {
      AR: ["AK","M4A1","SCAR","GROZA","FAMAS","AN94","XM8","M14","PARAFAL","KINGFISHER","AUG","AC80"],
      SMG: ["MP40","MP5","UMP","VSS","THOMPSON","VECTOR","BIZON","UZI","MAC10"],
      SNIPER: ["AWM","KAR98K","M82B","M24","SVD","SKS","WOODPECKER"],
      SHOTGUN: ["M1014","M1887","MAG7","SPAS12","Trogon"],
      PISTOLS: ["USP","G18","M500","Desert Eagle","Treatment Pistol","Hand Cannon"],
      LAUNCHERS: ["M79","RGS50","MGL140"],
      SPECIAL: ["Plasma Gun","Laser Gun (CS)","CG15","Crossbow","Flame Bow"]
    };
    for(const cat in grouped){
      // category label
      const catLabel = document.createElement('div');
      catLabel.style.width = '100%';
      catLabel.style.fontSize = '12px';
      catLabel.style.color = 'var(--muted)';
      catLabel.style.margin = '8px 0 4px';
      catLabel.textContent = cat;
      gunsList.appendChild(catLabel);
      grouped[cat].forEach(g => {
        const id = 'g_' + g.replace(/\s+/g,'_');
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" id="${id}" name="guns" value="${g}" style="margin-right:6px"> ${g}`;
        gunsList.appendChild(label);
      });
    }
    gunSelection.setAttribute('aria-hidden', 'false');
  } else {
    hide(gunSelection);
    gunsList.innerHTML = '';
    gunSelection.setAttribute('aria-hidden', 'true');
  }
}

function toggleCustomFee(){
  if(feeEl.value === 'custom') show(customFeeEl); else hide(customFeeEl);
}

// Join flow: optional deduct -> joins
async function joinMatch(){
  setMessage('');
  // validations
  if(!selectedType){
    setMessage('Select match type on the left first');
    return;
  }
  if(!selectedPrizeSystem){
    setMessage('Select prize system (teams) or pick 1v1 which defaults to kill_based');
    return;
  }

  const game = gameEl.value;
  const mode = modeEl.value;
  const map = mapEl.value || undefined;
  const uid = (uidEl.value || '').trim();
  const cc = (countryCodeEl.value || '').trim();
  const whatsappRaw = (whatsappEl.value || '').replace(/[\s-]/g,'').trim();
  const feeVal = feeEl.value === 'custom' ? parseInt((customFeeEl.value||'0'),10) : parseInt(feeEl.value,10);
  const headshot = document.getElementById('headshot')?.value === 'true';
  const characterSkill = document.getElementById('characterSkill')?.value === 'true';
  const gunAttributes = document.getElementById('gunAttributes')?.value === 'true';
  const throwableLimit = document.getElementById('throwableLimit')?.value === 'true';
  const roomType = roomTypeEl.value;

  if(!uid){ setMessage('Enter your Game UID'); return; }
  if(!cc || !cc.startsWith('+')){ setMessage('Select a valid country code'); return; }
  if(!/^\d{10,15}$/.test(whatsappRaw)){ setMessage('Enter a valid WhatsApp number (10‚Äì15 digits)'); return; }
  if(isNaN(feeVal) || feeVal < 0){ setMessage('Enter a valid entry fee'); return; }

  // Free Fire mode/map validation
  if(game === 'Free Fire'){
    if(!['Clash Squad','Lone Wolf'].includes(mode)){
      setMessage('Invalid Free Fire mode'); return;
    }
    if(mode === 'Clash Squad' && (!map || !CLASH_SQUAD_MAPS.includes(map))){
      setMessage('Select a valid Clash Squad map'); return;
    }
    if(mode === 'Lone Wolf' && map !== 'Iron Cage'){
      setMessage('Lone Wolf only supports Iron Cage'); return;
    }
  }

  // collect selected guns if Advance
  const selectedGuns = [];
  if(game === 'Free Fire' && roomType === 'Advance'){
    document.querySelectorAll('#gunsList input[type=checkbox]:checked').forEach(cb => selectedGuns.push(cb.value));
  }

  // build payload
  const payload = {
    type: selectedType,
    game,
    mode,
    fee: feeVal,
    uid,
    prizeSystem: selectedPrizeSystem,
    countryCode: cc,
    whatsappNumber: whatsappRaw,
    map,
    headshot,
    characterSkill,
    gunAttributes,
    throwableLimit,
    selectedGuns
  };

  try{
    // optional deduct step
    if(API_BASE && API_BASE.trim() !== ''){
      setMessage('üí∞ Deducting entry fee...', false);
      const deductRes = await fetch(`${API_BASE}/deduct`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...(TOKEN ? { Authorization: 'Bearer ' + TOKEN } : {}) },
        body: JSON.stringify({ fee: feeVal })
      });
      const deductData = await deductRes.json().catch(()=>({ success:false, msg:'Deduct parse error' }));
      if(!deductRes.ok || !deductData.success){
        throw new Error(deductData.msg || 'Deduction failed');
      }
    } else {
      // if no API_BASE configured, skip deduct step
      setMessage('Skipping deduct step (API_BASE not set)', false);
    }

const game = gameEl.value;

if(game === 'BGMI'){
  setMessage('‚ö†Ô∏è BGMI matches feature are coming soon. You cannot join right now.');
  return;
}


    // join endpoint
    setMessage('‚è≥ Joining match...', false);
    // call joins route (wallet/joins under API_BASE)
    const joinsRes = await fetch(`${API_BASE}/joins`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', ...(TOKEN ? { Authorization: 'Bearer ' + TOKEN } : {}) },
      body: JSON.stringify(payload)
    });
    const joinData = await joinsRes.json().catch(()=>({ success:false, msg:'Join parse error' }));
    if(!joinsRes.ok || !joinData.success){
      throw new Error(joinData.msg || 'Failed to join');
    }



    // success
    setMessage(`üéâ Joined ‚Äî assigned to ${joinData.assignedTeam || (joinData.match && joinData.match.players && joinData.match.players.slice(-1)[0]?.team) || 'N/A'}`, false);

    // When join is successful


// Redirect after 1 second
setTimeout(() => {
  const matchId = joinData.match?._id || joinData.match?.id || joinData.matchId;
  if (matchId) {
    window.location.href = `user-room.html?id=${matchId}`;
  } else {
    console.error("Match ID missing in join response.");
  }
}, 1000);


    // optional UI updates: reset small fields or route to room
    // e.g. window.location.href = `user-room.html?matchId=${joinData.match._id}&uid=${encodeURIComponent(uid)}`;
  } catch(err){
    console.error('join error', err);
    setMessage('‚ùå ' + (err.message || 'Join failed'));
  }
}

// initialization
(function init(){
  // default prize system title: none until selection
  // set up game/mode options and UI state
  updateGameOptions();
  hide(prizeSystemSection);
  // default: show selection left, allow clicking to open
  // Note: when user clicks a mode we hide the left column via openMatchForm()
})();

/* Expose helper for left panel to set prize system from old buttons */
function selectPrizeSystemFromLeft(ps){
  selectPrizeSystem(ps);
}

// ensure UI functions are available to left buttons
window.openMatchForm = openMatchForm;
window.selectPrizeSystem = selectPrizeSystem;
window.backToModes = backToModes;
window.showHome = showHome;
window.updateGameOptions = updateGameOptions;
window.updateMapOptions = updateMapOptions;
window.toggleGunSelection = toggleGunSelection;
window.toggleCustomFee = toggleCustomFee;
window.joinMatch = joinMatch;




/* ------------- Attach listeners & init UI ------------- */
  safeCall(() => {
    if(refs.gameSelect) refs.gameSelect.addEventListener('change', populateGameModeOptions);
    if(refs.modeSelect) refs.modeSelect.addEventListener('change', updateMapOptions);
    if(refs.roomType) refs.roomType.addEventListener('change', toggleGunSelection);
    if(refs.feeSelect) refs.feeSelect.addEventListener('change', toggleCustomFee);
    if(refs.form) hide(refs.form);
    if(refs.prizeSystemSection) hide(refs.prizeSystemSection);
    toggleGunSelection();
    populateGameModeOptions();
  });

  /* ------------- Auto-call promos/tournaments/winners/wallet (safe) ------------- */
  safeCall(() => preserved.loadPromos && preserved.loadPromos());
  safeCall(() => preserved.loadTournaments && preserved.loadTournaments()); // preserved.loadTournaments prefers pre-existing, otherwise uses our loadTournaments
  safeCall(() => preserved.fetchWinners && preserved.fetchWinners());
  safeCall(() => preserved.fetchWalletBalance && preserved.fetchWalletBalance());

  console.info('Hybrid GameZone JS initialized (Option C) ‚Äî tournaments + wallet functions wired.');

})(); 





// --- Load tournaments ---





async function joinTournament(id){ if(!token){ alert('Login required'); window.location.href='login.html'; return; } window.location.href = `uid.html?id=${id}`; }

async function leaveTournament(id){ if(!confirm('Are you sure you want to leave?')) return; try{ const res = await fetch(`${API_BASE}/leave/${id}`, { method:'DELETE', headers:{ Authorization:'Bearer '+token }}); const d = await res.json(); alert(d.msg || 'Left'); loadTournaments(); }catch(e){ console.error(e); alert('Failed to leave'); } }




// ----------------- TOKEN & API -----------------

// ----------------- HELPER -----------------
function formatDateTime(dt) {
  if (!dt) return "N/A";
  const d = new Date(dt);
  return d.toLocaleString(); // e.g., "12/8/2025, 2:30:15 PM"
}

// ----------------- VIEW TOURNAMENT -----------------
async function viewTournament(id) {
  if (!id) return alert("Invalid tournament ID");

  try {
    const res = await fetch(`${API_BASE}/tournaments/${id}`, {
      headers: token ? { Authorization: 'Bearer ' + token } : {}
    });

    const t = await res.json();

    if (!res.ok) {
      alert(t.msg || "Failed to fetch tournament");
      return;
    }

    // Check if user has joined
    if (t.joined) {
      // Show tournament details
      const info = `
Tournament: ${t.name || "N/A"}
Game: ${t.game || "N/A"}
Date: ${formatDateTime(t.date || t.startTime)}
Room ID: ${t.roomInfo?.roomId || "N/A"}
Password: ${t.roomInfo?.roomPassword || "N/A"}
      `;
      alert(info);

      // Mark room seen
      try {
        await fetch(`${API_BASE}/tournaments/${id}/room-seen`, {
          method: "POST",
          headers: token ? { Authorization: 'Bearer ' + token } : {}
        });
      } catch (e) {
        console.warn("Failed to mark room as seen", e);
      }

      // Refresh tournaments list if needed
      if (typeof loadTournaments === "function") loadTournaments();
    } else {
      alert("You must join this tournament to view room details.");
    }
  } catch (err) {
    console.error("viewTournament error:", err);
    alert("Failed to view tournament");
  }
}

// ----------------- EXAMPLE USAGE IN HTML -----------------
// <button class="btn btn-ghost" onclick="viewTournament('TOURNAMENT_ID_HERE')">View</button>




// Leaderboard helpers
// ‚≠ê Load tournaments into dropdown
async function loadLeaderboardTournaments() {
  try {
    const res = await fetch(`${API_BASE}/tournaments`, {
      headers: token ? { Authorization: "Bearer " + token } : {}
    });

    if (!res.ok) return;

    const arr = await res.json();

    const sel = document.getElementById("leaderboardSelect");
    sel.innerHTML = `<option value="">Select Tournament</option>`;

    (arr || []).forEach(t => {
      const o = document.createElement("option");
      o.value = t._id;
      o.textContent = `${t.name || t.title || "Tournament"} (${t.game})`;
      sel.appendChild(o);
    });

  } catch (e) {
    console.error("Tournament load error:", e);
  }
}

// ‚≠ê Load leaderboard for selected tournament
async function loadLeaderboard() {
  const tid = document.getElementById("leaderboardSelect").value;

  if (!tid) return alert("Please select a tournament first.");

  const container = document.getElementById("leaderboardContainer");
  container.innerHTML = "Loading...";

  try {
    const res = await fetch(`${API_BASE}/leaderboard/${tid}`);
    const d = await res.json();

    if (!d.leaderboard || !d.leaderboard.length) {
      container.innerHTML = `
        <div style="padding:8px;">No winners yet for ${d.tournamentName || "this tournament"}.</div>
      `;
      return;
    }

    const sorted = d.leaderboard.sort((a, b) => a.position - b.position);

    // Fallback avatar
    const fallback = "https://cdn-icons-png.flaticon.com/512/147/147144.png";

    // Top 3 cards
    container.innerHTML = `
      <div class="tl-top-wrapper">
        ${[1, 2, 3]
          .map(pos => {
            const p =
              sorted.find(x => x.position === pos) || {
                name: "Waiting...",
                avatarUrl: fallback,
                prize: 0
              };

            return `
            <div class="tl-top-card">
              <img src="${p.avatarUrl || fallback}">
              <h4>${pos === 1 ? "ü•á" : pos === 2 ? "ü•à" : "ü•â"} ${p.name}</h4>
              <div>‚Çπ${p.prize}</div>
            </div>
            `;
          })
          .join("")}
      </div>
    `;
  } catch (e) {
    console.error("Leaderboard error:", e);
    container.innerHTML = "Error loading leaderboard.";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  loadLeaderboardTournaments();
});


// Promos & dummy wins
async function loadPromos(){ try{ const r = await fetch(`${API_BASE}/promos`); const promos = r.ok ? await r.json() : []; const track = document.getElementById('promoTrack'); track.innerHTML=''; const container = document.getElementById('promosContainer'); container.innerHTML=''; if(!promos || !promos.length) promos = [{title:'Sponsor', images:['https://picsum.photos/200/100']}]; promos.forEach(p=>{ const div = document.createElement('div'); div.className='promo-item'; const imgs = (p.images||[]).map(i=>`<img src="${UPLOADS_BASE}/${i}" alt="">`).join(''); div.innerHTML = `<strong style="display:block;margin-bottom:6px">${p.title}</strong>${imgs}`; track.appendChild(div); const lp = document.createElement('div'); lp.className='latest-promo'; lp.innerHTML = `<strong style="display:block;margin-bottom:6px">${p.title}</strong>${imgs}`; container.appendChild(lp); }); const winContainer = document.getElementById('winningInfo'); winContainer.innerHTML=''; const dummyWins = [ { game: "BGMI", member: "PlayerX", prize: 500 }, { game: "Free Fire", member: "Hero123", prize: 300 }, { game: "CODM", member: "Sniper99", prize: 700 }, { game: "BGMI", member: "AcePro", prize: 1000 } ]; dummyWins.forEach(w=>{ const div = document.createElement('div'); div.className='win-card'; div.innerHTML=`<h4>${w.game}</h4><p>Member: ${w.member}</p><p>Winning: ‚Çπ${w.prize}</p>`; winContainer.appendChild(div); }); }catch(err){ console.error(err); } }

// Active match
// Active match
// Active match
/* -------------------------------------------------------
   LOAD ACTIVE MATCHES (ALL USERS)
   API: /api/my-active   (supports both array + object)
--------------------------------------------------------*/
async function loadActiveMatch() {
  const token = localStorage.getItem("token");
  if (!token) return;

  try {
    const res = await fetch(`${API_BASE}/active-matches`, {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    console.log("Active Match:", data);

    const box = document.getElementById("activeMatchBox");
    const content = document.getElementById("activeMatchContent");

    if (!data.success || !data.data) {
      box.style.display = "none";
      return;
    }

    const match = data.data;

    // hide if completed
    if (match.status === "completed") {
      box.style.display = "none";
      return;
    }

    box.style.display = "block";

    // status label
    const statusLabel =
      match.status === "room_published"
        ? `<span style="color:#4cff4c;font-weight:bold;">Room Published ‚úì</span>`
        : `<span style="color:#ffea55;">Waiting for Admin to Upload Room‚Ä¶</span>`;

    // prize system
    let prizeHtml = "";
    if (match.prizeSystem) {
      let prizeType = "-";
      if (match.prizeSystem === "kill_based") prizeType = "Kill Based";
      if (match.prizeSystem === "team_equal") prizeType = "Team Equal";
      prizeHtml = `<p><strong>Prize System:</strong> ${prizeType}</p>`;
    }

    // all players list
    let fullList = [...(match.players || [])];

    // sort players by team
    fullList.sort((a, b) => (a.team || 0) - (b.team || 0));

    // max players based on type
    let maxPlayers = fullList.length;
    const type = match.type.toLowerCase();
    if (type === "1v1") maxPlayers = 2;
    else if (type === "2v2") maxPlayers = 4;
    else if (type === "3v3") maxPlayers = 6;
    else if (type === "4v4") maxPlayers = 8;

    const finalPlayers = fullList.slice(0, maxPlayers);

    // ‚≠ê NO UID ‚Äî ONLY PLAYER NAME
    const playersList = finalPlayers
      .map(
        (p, i) =>
          `${i + 1}. ${p.name}${p.team != null ? ` - Team ${p.team}` : ""}`
      )
      .join("<br>");

    // final UI
    content.innerHTML = `
      <p><strong>Game:</strong> ${match.game}</p>
      <p><strong>Mode:</strong> ${match.mode}</p>
      <p><strong>Type:</strong> ${match.type}</p>
      <p><strong>Entry Fee:</strong> ‚Çπ${match.entryFee}</p>

      ${prizeHtml}

      <p><strong>Status:</strong> ${statusLabel}</p>

      <p style="opacity:0.7;margin-top:6px;">
        <strong>Match ID:</strong> ${match._id}
      </p>

      <div style="margin-top:12px;">
        <strong>Players:</strong><br>
        ${playersList}
      </div>

      <button onclick="gotoRoom('${match._id}')">View Room</button>
    `;
  } catch (err) {
    console.error("Active match error:", err);
  }
}

function gotoRoom(id) {
  window.location.href = `user-room.html?matchId=${id}`;
}

document.addEventListener("DOMContentLoaded", () => {
  loadActiveMatch();
});



async function fetchWalletBalance(){ const walletDiv = document.getElementById('walletBalance'); if(!token){ walletDiv.textContent = 'üí∞ Wallet Balance: (login required)'; return; } try{ const res = await fetch(`${BACKEND_URL}/balance`, { headers: { 'Content-Type':'application/json', ...(token?{ Authorization:`Bearer ${token}` }:{} ) } }); if(!res.ok) throw new Error('fetch failed'); const d = await res.json(); walletDiv.textContent = `üí∞ Wallet Balance: ‚Çπ${d.balance ?? 0}`; }catch(e){ console.error('wallet fetch err',e); document.getElementById('walletBalance').textContent = '‚ö† Failed to fetch wallet balance'; } }

function gotoProfile(){ location.href='profile.html'; }


async function loadRecentWinners(){
  const container = document.getElementById("winnerList");
  container.innerHTML = "Loading...";
  try{
    const res = await fetch(`${API_BASE}/admin/match/results`, {
      method:"GET",
      headers:{ "Authorization":"Bearer "+token, "Content-Type":"application/json" }
    });
    const data = await res.json();
    if(!data.success){ container.innerHTML = "Failed to load winners."; return; }

    const matches = data.list.filter(m=>m.completed); // only completed matches
    if(!matches.length){ container.innerHTML = ""; return; }

    const cards = matches.map(match=>{
      let winner = null;
      const prizeSystem = match.prizeSystem || "team_equal";
      const players = (match.results || match.data || []).map(p=>({
        userId:p.userId, name:p.name||"-", team:p.team||"-", kills:Number(p.kills)||0
      }));

      if(match.type==="1v1"){
        winner = players.sort((a,b)=>b.kills-a.kills)[0];
      } else {
        const winnerTeam = match.winnerTeam;
        const winnerPlayers = players.filter(p=>p.team===winnerTeam);
        if(prizeSystem==="team_equal"){
          const totalCollected = (match.entryFee * players.length);
          const prizePool = totalCollected - totalCollected*0.08;
          winnerPlayers.forEach(p=> p.share = prizePool / winnerPlayers.length);
          winner = winnerPlayers[0]; // show first in team
        } else {
          const totalKills = winnerPlayers.reduce((s,p)=>s+p.kills,0);
          const totalCollected = (match.entryFee * players.length);
          const prizePool = totalCollected - totalCollected*0.08;
          winnerPlayers.forEach(p=> p.share = totalKills ? (p.kills/totalKills)*prizePool : prizePool/winnerPlayers.length);
          winner = winnerPlayers.sort((a,b)=>b.share - a.share)[0]; // top share
        }
      }

      const winningPrice = winner.share ? winner.share.toFixed(2) : "0.00";

      return `
        <div class="winnerCard">
          <b>${winner.name}</b><br>
          <span class="small">Match #${match.matchNumber}</span><br>
          <span class="small">${match.game} ‚Ä¢ ${match.mode}</span><br>
          <span class="small">Winning: ‚Çπ${winningPrice}</span>
        </div>
      `;
    }).join("");

    container.innerHTML = cards;

  }catch(err){
    console.error(err);
    container.innerHTML = "Network error while loading winners.";
  }
}




async function fetchWinners() {
  try {
    const res = await fetch('http://localhost:5000/api/wallet/matches/winners');
    const data = await res.json();
    const container = document.getElementById('matches');
    container.innerHTML = '';

    if (!data.success || !data.list.length) {
      container.innerHTML = '<p style="text-align:center;">No winners yet.</p>';
      return;
    }

    const matches = data.list.slice(0,3); // Only last 3 matches for slideshow
    let index = 0;

    function renderMatch(i) {
      const match = matches[i];
      let winnersHTML = '';

      if (match.winners.length === 0) {
        winnersHTML = '<p class="no-winner">No winners declared</p>';
      } else {
        winnersHTML = match.winners.map(p => `
          <div class="winner-row" style="display:flex;align-items:center;margin:8px 0;padding:6px;background:#111;border-radius:10px;">
            <img src="${p.avatarUrl || 'https://i.ibb.co/2d1zY0m/user.png'}" 
                 alt="${p.name}" 
                 style="width:50px;height:50px;border-radius:50%;object-fit:cover;margin-right:12px;" />
            <div style="flex:1;color:#fff;">
              <p style="margin:0;font-weight:600;">${p.name} (${p.uid})</p>
              
              <p style="margin:0;color:#0dfc89;">Winning Price: ‚Çπ${p.winningPrice}</p>
            </div>
          </div>
        `).join('');
      }

      const html = `
        <div class="winner-card" style="
          display:flex;
          background:#1a1a1a;
          border-radius:16px;
          padding:16px;
          color:white;
          box-shadow:0 0 12px rgba(0,0,0,0.5);
          animation:fade 0.5s ease;
        ">
          <div class="winner-sidebar" style="flex:0 0 180px; padding-right:12px; border-right:1px solid #333;">
            <h3 style="margin-bottom:6px;">${match.matchNumber}</h3>
            <p style="margin:2px 0;"><strong>Type:</strong> ${match.type}</p>
            <p style="margin:2px 0;"><strong>Game:</strong> ${match.game}</p>
            <p style="margin:2px 0;"><strong>Mode:</strong> ${match.mode}</p>
            <p style="margin:2px 0;"><strong>Prize System:</strong> ${match.prizeSystem || 'N/A'}</p>
            <p style="margin:2px 0;color:#ffd700;"><strong>Total Prize:</strong> ‚Çπ${match.prizeGiven}</p>
            <p style="margin:2px 0;font-size:12px;color:#aaa;"><strong>Completed:</strong><br>${new Date(match.completedAt).toLocaleString()}</p>
          </div>
          <div class="winner-list" style="flex:1; padding-left:12px;">
            <h4 style="margin-top:0;color:#0dfc89;">Winner Players</h4>
            ${winnersHTML}
          </div>
        </div>
        <style>
          @keyframes fade {
            from { opacity:0; transform:translateY(10px);}
            to { opacity:1; transform:translateY(0);}
          }
        </style>
      `;

      container.innerHTML = html;
    }

    // initial render
    renderMatch(index);

    // auto slideshow every 5 seconds
    setInterval(() => {
      index = (index + 1) % matches.length;
      renderMatch(index);
    }, 5000);

  } catch (err) {
    console.error("Error fetching winners:", err);
    document.getElementById('matches').innerHTML = '<p style="text-align:center;">Error loading winners.</p>';
  }
}

// FRONTEND JS





document.addEventListener("DOMContentLoaded", () => {

  /* ----------------------------------
        GAME CONFIG
  -----------------------------------*/
  const GAME_CONFIG = { 
    "Ludo": {
      types: ["1v1","1v2","1v3","2v2"],
      modes: ["classic","popular","quick"],
    },
    "Carrom": {
      types: ["1v1","2v2"],
      modes: ["classic","freestyle"],
    },
    "8 Ball Pool": {
      types: ["1v1"],
      modes: ["classic"]
    },
    "Cricket": {
      types: ["1v1"],
      modes: ["1 over"]
    }
  };

  /* ----------------------------------
        DOWNLOAD LINKS
  -----------------------------------*/
  const DOWNLOAD_LINKS = {
    "Ludo": "https://play.google.com/store/apps/details?id=com.ludo.king",
    "Carrom": "https://play.google.com/store/apps/details?id=com.miniclip.carrom",
    "8 Ball Pool": "https://play.google.com/store/apps/details?id=com.miniclip.eightballpool",
    "Cricket": "https://play.google.com/store/apps/details?id=com.miniclip.cricketleague"
  };

  /* ----------------------------------
        DOM ELEMENTS
  -----------------------------------*/
  const selectedTitle = document.getElementById('selectedTitle');
  const formArea = document.getElementById('formArea');
  const matchType = document.getElementById('matchType');
  const matchMode = document.getElementById('matchMode');

  // ‚≠ê New Entry Fee Elements
  const feeSelect = document.getElementById('fee');
  const entryFee = document.getElementById('entryFee');

  const gameUID = document.getElementById('gameUID');
  const whatsapp = document.getElementById('whatsapp');
  const joinBtn = document.getElementById('joinBtn');
  const message = document.getElementById('message');
  const downloadBtn = document.getElementById('downloadGameBtn');
  const cricketNote = document.getElementById('cricketNote');

  let selectedGame = null;

  function setMessage(text, color = 'lightgreen') {
    message.style.color = color;
    message.textContent = text;
  }

  function updateUIDLabel(game) {
    let label = "Game UID:";
    if (game === "Ludo") label = "Ludo King ID:";
    else if (game === "Carrom") label = "Carrom ID:";
    else if (game === "8 Ball Pool") label = "Unique-ID:";
    else if (game === "Cricket") label = "Cricket login facebook profile link:";
    document.getElementById('gameUIDLabel').textContent = label;
  }

  function updateUIDPlaceholder(game) {
    if (game === "Ludo") gameUID.placeholder = "Enter Ludo King ID";
    else if (game === "Carrom") gameUID.placeholder = "Enter Carrom ID";
    else if (game === "8 Ball Pool") gameUID.placeholder = "Enter Unique ID";
    else if (game === "Cricket") gameUID.placeholder = "Paste your Cricket login facebook ID link";
  }

  /* ----------------------------------
       ENTRY FEE DROPDOWN + CUSTOM
  -----------------------------------*/
  feeSelect.addEventListener("change", () => {
    if (feeSelect.value === "custom") {
      entryFee.style.display = "block";
      entryFee.value = "";
    } else {
      entryFee.style.display = "none";
      entryFee.value = feeSelect.value; // auto-fill
    }
  });

  entryFee.addEventListener("input", () => {
    if (Number(entryFee.value) < 50) {
      setMessage("Minimum custom entry fee is ‚Çπ50", "salmon");
      joinBtn.disabled = true;
      joinBtn.style.opacity = "0.5";
    } else {
      message.textContent = "";
      joinBtn.disabled = false;
      joinBtn.style.opacity = "1";
    }
  });


  /* ----------------------------------
       GAME CARD CLICK
  -----------------------------------*/
  document.querySelectorAll('.game-card').forEach(card => {
    card.addEventListener('click', () => {

      document.querySelectorAll('.game-card')
        .forEach(c => c.classList.remove('active'));
      card.classList.add('active');

      selectedGame = card.dataset.game;
      selectedTitle.textContent = "Joining: " + selectedGame;
      formArea.style.display = 'block';

      populateTypeMode(selectedGame);

      if (selectedGame === "Cricket") {
        cricketNote.style.display = "block";
      } else {
        cricketNote.style.display = "none";
      }

      updateUIDLabel(selectedGame);
      updateUIDPlaceholder(selectedGame);

      if (DOWNLOAD_LINKS[selectedGame]) {
        downloadBtn.style.display = "block";
        downloadBtn.textContent = `Download ${selectedGame}`;
        downloadBtn.onclick = () => window.open(DOWNLOAD_LINKS[selectedGame], "_blank");
      }
    });
  });

  /* ----------------------------------
        POPULATE TYPE + MODE
  -----------------------------------*/
  function populateTypeMode(game) {
    const cfg = GAME_CONFIG[game];
    matchType.innerHTML = "";
    matchMode.innerHTML = "";

    cfg.types.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      matchType.appendChild(opt);
    });

    cfg.modes.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      matchMode.appendChild(opt);
    });
  }

  /* ----------------------------------
        JOIN BUTTON
  -----------------------------------*/
  joinBtn.addEventListener("click", async () => {

    setMessage("");

    // ‚≠ê Get correct Entry Fee
    const finalEntryFee =
      feeSelect.value === "custom"
        ? Number(entryFee.value)
        : Number(feeSelect.value);

    if (finalEntryFee < 50) {
      return setMessage("Minimum entry fee is ‚Çπ50", "salmon");
    }

    const payload = {
      game: selectedGame,
      type: matchType.value,
      mode: matchMode.value,
      entryFee: finalEntryFee,
      uid: gameUID.value.trim(),
      whatsappNumber: whatsapp.value.trim()
    };

    if (!payload.game) return setMessage("Select a game!", "salmon");
    if (!payload.uid) return setMessage("Enter your UID", "salmon");
    if (!payload.whatsappNumber) return setMessage("Enter WhatsApp Number", "salmon");

    const API = "http://localhost:5000/api/wallet/join";
    const token = localStorage.getItem("token");

    try {
      setMessage("Joining...");

      const res = await fetch(API, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          ...(token ? { "Authorization": `Bearer ${token}` } : {})
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (res.ok && data.success) {
        setMessage("Joined successfully!");
        window.location.href = data.redirectUrl ||
          `user-room.html?matchId=${data.matchId}`;
      } else {
        setMessage("‚ùå " + data.msg, "salmon");
      }

    } catch (err) {
      setMessage("Network error", "salmon");
    }
  });

}); // DOMContentLoaded






// fetch on load
fetchWinners();



// refresh every 30 seconds
loadRecentWinners();
setInterval(loadRecentWinners, 30000);

// Init
window.addEventListener('DOMContentLoaded', ()=>{
  updateGameModes();
  loadPromos();
  loadLeaderboardTournaments();
  loadTournaments();
  fetchWalletBalance();
  loadActiveMatch();
});


    window.addEventListener("load", () => {
        setTimeout(() => {
            document.getElementById("pageLoader").classList.add("hide-loader");
        }, 400);
    });



</script>
</body>
</html> 